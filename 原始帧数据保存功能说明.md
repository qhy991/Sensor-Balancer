# 原始帧数据保存功能说明

## 概述

新增的原始帧数据保存功能允许您保存所有收集的原始帧数据，而不仅仅是平均值。这对于深度分析、数据验证和后续处理非常有用。

## 功能特点

### 🔍 **数据完整性**
- **保存所有原始帧**: 不再只保存平均值，而是保存每一帧的完整数据
- **保留时间序列**: 保持数据的时序信息，便于分析传感器响应变化
- **包含元数据**: 保存时间戳、帧数、数据形状等元信息

### 📁 **支持格式**

#### 1. NPZ格式 (推荐)
- **文件扩展名**: `.npz`
- **特点**: NumPy压缩格式，文件小，加载快
- **压缩比**: 约4.3倍压缩率
- **适用场景**: 大量数据，需要快速加载

#### 2. JSON格式
- **文件扩展名**: `.json`
- **特点**: 文本格式，可读性好，跨平台兼容
- **文件大小**: 较大，但便于查看和编辑
- **适用场景**: 数据共享，需要人工查看

## 使用方法

### 📊 **保存原始帧数据**

1. **收集数据**: 完成参考数据收集后
2. **点击按钮**: "保存原始帧数据"
3. **选择格式**: 选择NPZ或JSON格式
4. **选择位置**: 选择保存路径和文件名
5. **确认保存**: 系统会显示保存结果和文件信息

### 📂 **加载原始帧数据**

1. **点击按钮**: "加载原始帧数据"
2. **选择文件**: 选择之前保存的NPZ或JSON文件
3. **自动加载**: 系统会自动加载所有帧数据和参考数据
4. **继续分析**: 可以继续进行校正分析

## 数据格式说明

### NPZ格式结构
```python
{
    'frames': array(200, 64, 64),      # 所有原始帧数据
    'reference_data': array(64, 64),   # 平均参考数据
    'timestamp': '2024-01-15T10:30:00', # 保存时间
    'frame_count': 200,                # 帧数
    'frame_shape': [64, 64]            # 单帧数据形状
}
```

### JSON格式结构
```json
{
    "frames": [[[0.0001, 0.0002, ...], ...], ...],  // 所有帧数据
    "reference_data": [[0.0001, 0.0002, ...], ...], // 平均参考数据
    "timestamp": "2024-01-15T10:30:00",
    "frame_count": 200,
    "frame_shape": [64, 64]
}
```

## 文件大小对比

| 格式 | 200帧数据 | 压缩比 | 特点 |
|------|-----------|--------|------|
| NPZ | ~6MB | 4.3x | 推荐格式 |
| JSON | ~26MB | 1x | 可读性好 |

## 应用场景

### 🔬 **深度分析**
- **时间序列分析**: 分析传感器响应随时间的变化
- **稳定性评估**: 评估数据收集过程中的稳定性
- **异常检测**: 识别异常帧或传感器故障

### 📈 **数据验证**
- **质量检查**: 验证数据收集质量
- **重复性测试**: 进行多次测试并比较结果
- **参数优化**: 测试不同收集参数的效果

### 🔧 **后续处理**
- **重新计算**: 使用不同的平均方法重新计算参考数据
- **数据筛选**: 去除异常帧后重新计算
- **统计分析**: 进行更详细的统计分析

## 使用示例

### 保存数据
```python
# 收集200帧数据后
frames = [...]  # 200帧64x64数据
reference_data = np.mean(frames, axis=0)

# 保存为NPZ格式
np.savez_compressed(
    "my_calibration_data.npz",
    frames=np.array(frames),
    reference_data=reference_data,
    timestamp=datetime.now().isoformat(),
    frame_count=len(frames),
    frame_shape=frames[0].shape
)
```

### 加载数据
```python
# 加载NPZ文件
data = np.load("my_calibration_data.npz")
frames = [frame for frame in data['frames']]
reference_data = data['reference_data']

print(f"加载了 {len(frames)} 帧数据")
print(f"参考数据形状: {reference_data.shape}")
```

## 注意事项

### ⚠️ **存储空间**
- 原始帧数据文件较大，请确保有足够的存储空间
- 建议定期清理不需要的原始数据文件

### 🔄 **数据一致性**
- 加载原始数据后，系统会自动重新计算参考数据
- 确保加载的数据与当前传感器配置兼容

### 📊 **性能考虑**
- NPZ格式加载速度更快，推荐用于大量数据
- JSON格式便于查看和调试，适合小数据集

## 故障排除

### 常见问题

1. **保存失败**
   - 检查磁盘空间是否充足
   - 确认文件路径权限
   - 验证数据完整性

2. **加载失败**
   - 检查文件格式是否正确
   - 确认文件是否损坏
   - 验证数据形状是否匹配

3. **文件过大**
   - 考虑减少收集帧数
   - 使用NPZ格式压缩
   - 定期清理旧数据

## 总结

原始帧数据保存功能大大增强了数据管理的灵活性，让您能够：
- 保存完整的原始数据
- 进行深度分析和验证
- 支持后续的数据处理需求
- 提高数据质量和可靠性

建议优先使用NPZ格式保存大量数据，JSON格式用于数据共享和调试。 