# 传感器敏感性标定程序使用说明

## 问题诊断和解决方案

### 问题：测量开始后没有反应，进度都是0

**可能原因和解决方案：**

#### 1. 传感器未连接
**症状：** 测量开始后立即显示"传感器已断开连接"
**解决方案：**
1. 确保先点击"开始"按钮连接传感器
2. 等待状态显示为"已连接"或"模拟模式"
3. 然后再开始测量

#### 2. 校准数据未加载
**症状：** 点击"开始测量"时提示"请先加载校准数据"
**解决方案：**
1. 切换到"敏感性标定"标签页
2. 点击"加载校准数据"按钮
3. 选择之前保存的校准数据文件（JSON、NPY或CSV格式）
4. 确认校准数据已加载（状态显示为绿色）

#### 3. 砝码未添加
**症状：** 点击"开始测量"时提示"请选择砝码"
**解决方案：**
1. 在"砝码管理"区域添加砝码：
   - 输入砝码ID（如：W1、W2、W3）
   - 输入质量值
   - 选择质量单位
   - 点击"添加砝码"按钮
2. 重复添加所有需要使用的砝码

## 正确的使用步骤

### 第一步：启动程序
```bash
python sensor_sensitivity_calibration.py
```

### 第二步：连接传感器
1. 选择传感器ID（通常为0）
2. 输入端口号（通常为0，或COM3等）
3. 点击"开始"按钮
4. 等待状态显示为"已连接"或"模拟模式"

### 第三步：加载校准数据
1. 切换到"敏感性标定"标签页
2. 点击"加载校准数据"按钮
3. 选择校准数据文件
4. 确认校准数据已加载（状态栏显示"校准: 已加载"）

### 第四步：砝码管理
程序启动时会自动加载7个默认砝码：
- **默认砝码**: 50g, 100g, 150g, 500g, 550g, 600g, 650g

**砝码管理功能**:
1. **添加砝码**: 输入砝码ID、质量和单位，点击"添加砝码"
2. **重置默认砝码**: 点击"重置默认砝码"恢复默认的7个砝码
3. **自定义默认砝码**: 点击"自定义默认砝码"设置自己的默认砝码列表

**自定义默认砝码格式**:
```
W1,25.0,g
W2,75.0,g
W3,200.0,g
```
每行一个砝码，格式：ID,质量,单位

**砝码表格显示**: 所有砝码都会在表格中显示，包括ID、质量、单位和计算出的力(N)

### 第五步：开始测量
1. 在"测量控制"区域：
   - 选择要测量的砝码（如W1）
   - 设置测量次数（建议10-20次）
   - 点击"开始测量"按钮
2. 将选定的砝码放置在传感器上
3. 等待测量完成（进度条会显示进度）
4. 更换下一个砝码，重复测量

### 第六步：计算敏感性
1. 完成所有砝码测量后
2. 点击"计算敏感性"按钮
3. 查看标定结果表格
4. 查看整体敏感性分析结果
5. **自动生成质量-压力关系图表** ⭐ **新功能**

### 第七步：分析图表
**新增功能**: 计算敏感性后会自动弹出图表窗口，包含4个子图：

1. **质量-总压力关系图**: 显示质量与总压力的关系曲线
2. **质量-敏感性关系图**: 显示质量与敏感性的关系曲线  
3. **压力-敏感性关系图**: 显示压力与敏感性的关系散点图
4. **测量稳定性分析图**: 显示各砝码的变异系数，用颜色区分稳定性等级

**图表功能**:
- 数据点标签显示砝码质量
- 连接线显示趋势
- 颜色编码表示稳定性等级
- 支持保存为PNG/JPG/PDF/SVG格式

### 第八步：保存结果
1. 点击"保存结果"按钮
2. 选择保存格式（JSON/CSV/文本）
3. 选择保存位置
4. 可选择保存图表图片

## 调试信息说明

程序会输出详细的调试信息，帮助诊断问题：

### 正常流程的调试信息
```
🚀 开始测量: 砝码=W1, 次数=10
✅ 测量状态: measurement_active=True
✅ 已通知父窗口开始测量
🔍 开始测量砝码 W1，共 10 次
📊 测量中: W1 (1/10)
🔍 记录测量数据: measurement_active=True, current_weight_id=W1
✅ 记录成功，当前测量次数: 1/10
✅ 数据已传递给敏感性标定组件
...
✅ 测量完成，停止测量
```

### 常见错误信息
```
⚠️ 父窗口没有start_sensitivity_measurement方法
⚠️ 继续使用本地测量模式
```
**说明：** 这个警告不影响测量功能，程序会继续工作

```
⚠️ 测量未激活或砝码ID为空
```
**说明：** 测量状态设置有问题，检查是否按正确步骤操作

```
❌ 记录测量数据失败
```
**说明：** 砝码ID不存在，检查是否已添加该砝码

## 故障排除

### 1. 传感器连接失败
**解决方案：**
- 检查端口设置是否正确
- 确认传感器驱动程序已安装
- 尝试重新插拔USB连接
- 使用模拟模式进行测试

### 2. 校准数据加载失败
**解决方案：**
- 检查文件格式是否正确
- 确认文件路径没有特殊字符
- 验证校准数据文件完整性
- 尝试使用测试校准数据

### 3. 测量数据异常
**解决方案：**
- 检查传感器是否正常工作
- 确认砝码放置是否正确
- 验证环境条件是否稳定
- 增加测量次数以获得更可靠的结果

### 4. 程序崩溃或无响应
**解决方案：**
- 检查Python环境是否正确安装
- 确认依赖库是否完整（PyQt5、matplotlib、numpy等）
- 尝试重新启动程序
- 检查系统资源是否充足

## 测试模式

如果遇到问题，可以使用测试模式：

1. 运行测试脚本：
```bash
python test_measurement_fix.py
```

2. 使用模拟数据：
- 程序会自动生成模拟传感器数据
- 无需真实传感器即可测试功能

3. 使用测试校准数据：
- 程序会创建测试校准数据
- 用于验证校准功能

## 技术支持

如果问题仍然存在，请提供以下信息：
1. 错误信息和调试输出
2. 操作系统和Python版本
3. 传感器型号和连接方式
4. 校准数据文件格式
5. 具体的操作步骤

## 版本信息

- 程序版本：1.0
- 支持系统：Windows、Linux、macOS
- Python版本：3.7+
- 依赖库：PyQt5、matplotlib、numpy 